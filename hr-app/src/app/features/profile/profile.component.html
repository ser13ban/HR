<div class="profile-container">
  <!-- Header with back button -->
  <div class="profile-header">
    <button class="back-button" (click)="onGoBack()" aria-label="Go back to home">
      <span class="back-icon">‚Üê</span>
      Back to Home
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{ error() }}</p>
    <button class="retry-button" (click)="onRetry()">Try Again</button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="employee() && !loading() && !error()" class="profile-content">
    <div class="profile-card">
      <!-- Profile Header -->
      <div class="profile-card-header">
        <div class="profile-avatar">
          <img 
            [src]="getProfilePictureUrl(employee()!)" 
            [alt]="employee()!.fullName"
            class="avatar-image"
            (error)="$event.target.src = '/assets/images/default-avatar.svg'"
          />
        </div>
        <div class="profile-basic-info">
          <h1 class="profile-name">{{ employee()!.fullName }}</h1>
          <p class="profile-position">{{ employee()!.position }}</p>
          <span class="profile-role">{{ getRoleDisplayName(employee()!.role) }}</span>
          <div *ngIf="isOwnProfile()" class="own-profile-badge">
            Your Profile
          </div>
        </div>
        
        <!-- Edit Button -->
        <div *ngIf="canEdit() && !isEditing()" class="profile-actions">
          <button class="edit-button" (click)="toggleEditMode()" type="button">
            <span class="edit-icon">‚úèÔ∏è</span>
            Edit Profile
          </button>
        </div>
        
        <!-- Edit Actions -->
        <div *ngIf="isEditing()" class="edit-actions">
          <button 
            class="save-button" 
            (click)="saveProfile()" 
            [disabled]="saving()"
            type="button"
          >
            <span *ngIf="saving()" class="loading-icon">‚è≥</span>
            <span *ngIf="!saving()">üíæ</span>
            {{ saving() ? 'Saving...' : 'Save Changes' }}
          </button>
          <button 
            class="cancel-button" 
            (click)="cancelEdit()" 
            [disabled]="saving()"
            type="button"
          >
            Cancel
          </button>
        </div>
      </div>
      
      <!-- Save Error -->
      <div *ngIf="saveError()" class="save-error">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p>{{ saveError() }}</p>
      </div>

      <!-- Profile Details -->
      <div class="profile-details">
        <form *ngIf="isEditing()" [formGroup]="editForm" class="edit-form">
          <!-- Basic Information Section -->
          <div class="details-section">
            <h2 class="section-title">Basic Information</h2>
            <div class="form-grid">
              <div class="form-field">
                <label class="form-label" for="firstName">First Name *</label>
                <input 
                  type="text" 
                  id="firstName"
                  formControlName="firstName"
                  class="form-input"
                  [class.error]="getFieldError('firstName')"
                />
                <div *ngIf="getFieldError('firstName')" class="field-error">
                  {{ getFieldError('firstName') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="lastName">Last Name *</label>
                <input 
                  type="text" 
                  id="lastName"
                  formControlName="lastName"
                  class="form-input"
                  [class.error]="getFieldError('lastName')"
                />
                <div *ngIf="getFieldError('lastName')" class="field-error">
                  {{ getFieldError('lastName') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="email">Email *</label>
                <input 
                  type="email" 
                  id="email"
                  formControlName="email"
                  class="form-input"
                  [class.error]="getFieldError('email')"
                />
                <div *ngIf="getFieldError('email')" class="field-error">
                  {{ getFieldError('email') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="phoneNumber">Phone Number</label>
                <input 
                  type="tel" 
                  id="phoneNumber"
                  formControlName="phoneNumber"
                  class="form-input"
                  [class.error]="getFieldError('phoneNumber')"
                />
                <div *ngIf="getFieldError('phoneNumber')" class="field-error">
                  {{ getFieldError('phoneNumber') }}
                </div>
              </div>
            </div>
          </div>

          <!-- Work Information Section -->
          <div class="details-section">
            <h2 class="section-title">Work Information</h2>
            <div class="form-grid">
              <div class="form-field">
                <label class="form-label" for="department">Department</label>
                <input 
                  type="text" 
                  id="department"
                  formControlName="department"
                  class="form-input"
                  [class.error]="getFieldError('department')"
                />
                <div *ngIf="getFieldError('department')" class="field-error">
                  {{ getFieldError('department') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="team">Team</label>
                <input 
                  type="text" 
                  id="team"
                  formControlName="team"
                  class="form-input"
                  [class.error]="getFieldError('team')"
                />
                <div *ngIf="getFieldError('team')" class="field-error">
                  {{ getFieldError('team') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="position">Position</label>
                <input 
                  type="text" 
                  id="position"
                  formControlName="position"
                  class="form-input"
                  [class.error]="getFieldError('position')"
                />
                <div *ngIf="getFieldError('position')" class="field-error">
                  {{ getFieldError('position') }}
                </div>
              </div>
            </div>
          </div>

          <!-- Personal Information Section -->
          <div *ngIf="shouldShowField(employee()!, 'dateOfBirth')" class="details-section">
            <h2 class="section-title">Personal Information</h2>
            <div class="form-grid">
              <div class="form-field">
                <label class="form-label" for="dateOfBirth">Date of Birth</label>
                <input 
                  type="date" 
                  id="dateOfBirth"
                  formControlName="dateOfBirth"
                  class="form-input"
                  [class.error]="getFieldError('dateOfBirth')"
                />
                <div *ngIf="getFieldError('dateOfBirth')" class="field-error">
                  {{ getFieldError('dateOfBirth') }}
                </div>
              </div>
              
              <div class="form-field full-width">
                <label class="form-label" for="address">Address</label>
                <textarea 
                  id="address"
                  formControlName="address"
                  class="form-textarea"
                  rows="3"
                  [class.error]="getFieldError('address')"
                ></textarea>
                <div *ngIf="getFieldError('address')" class="field-error">
                  {{ getFieldError('address') }}
                </div>
              </div>
            </div>
          </div>

          <!-- Emergency Contact Section -->
          <div *ngIf="shouldShowField(employee()!, 'emergencyContact')" class="details-section">
            <h2 class="section-title">Emergency Contact</h2>
            <div class="form-grid">
              <div class="form-field">
                <label class="form-label" for="emergencyContact">Contact Name</label>
                <input 
                  type="text" 
                  id="emergencyContact"
                  formControlName="emergencyContact"
                  class="form-input"
                  [class.error]="getFieldError('emergencyContact')"
                />
                <div *ngIf="getFieldError('emergencyContact')" class="field-error">
                  {{ getFieldError('emergencyContact') }}
                </div>
              </div>
              
              <div class="form-field">
                <label class="form-label" for="emergencyPhone">Contact Phone</label>
                <input 
                  type="tel" 
                  id="emergencyPhone"
                  formControlName="emergencyPhone"
                  class="form-input"
                  [class.error]="getFieldError('emergencyPhone')"
                />
                <div *ngIf="getFieldError('emergencyPhone')" class="field-error">
                  {{ getFieldError('emergencyPhone') }}
                </div>
              </div>
            </div>
          </div>
        </form>

        <!-- View Mode -->
        <div *ngIf="!isEditing()">
          <div class="details-section">
            <h2 class="section-title">Work Information</h2>
            <div class="details-grid">
              <div class="detail-item">
                <label class="detail-label">Department</label>
                <span class="detail-value">{{ employee()!.department }}</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">Team</label>
                <span class="detail-value">{{ employee()!.team }}</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">Position</label>
                <span class="detail-value">{{ employee()!.position }}</span>
              </div>
              <div class="detail-item">
                <label class="detail-label">Start Date</label>
                <span class="detail-value">{{ formatDate(employee()!.startDate) }}</span>
              </div>
            </div>
          </div>

          <!-- Contact Information (only if not limited view) -->
          <div *ngIf="shouldShowField(employee()!, 'email')" class="details-section">
            <h2 class="section-title">Contact Information</h2>
            <div class="details-grid">
              <div class="detail-item" *ngIf="employee()!.email">
                <label class="detail-label">Email</label>
                <span class="detail-value">
                  <a [href]="'mailto:' + employee()!.email" class="email-link">
                    {{ employee()!.email }}
                  </a>
                </span>
              </div>
              <div class="detail-item" *ngIf="employee()!.phoneNumber">
                <label class="detail-label">Phone</label>
                <span class="detail-value">
                  <a [href]="'tel:' + employee()!.phoneNumber" class="phone-link">
                    {{ employee()!.phoneNumber }}
                  </a>
                </span>
              </div>
            </div>
          </div>

          <!-- Personal Information (only if not limited view) -->
          <div *ngIf="shouldShowField(employee()!, 'dateOfBirth') && (employee()!.dateOfBirth || employee()!.address)" class="details-section">
            <h2 class="section-title">Personal Information</h2>
            <div class="details-grid">
              <div class="detail-item" *ngIf="employee()!.dateOfBirth">
                <label class="detail-label">Date of Birth</label>
                <span class="detail-value">{{ formatDate(employee()!.dateOfBirth!) }}</span>
              </div>
              <div class="detail-item" *ngIf="employee()!.address">
                <label class="detail-label">Address</label>
                <span class="detail-value">{{ employee()!.address }}</span>
              </div>
            </div>
          </div>

          <!-- Emergency Contact (only if not limited view) -->
          <div *ngIf="shouldShowField(employee()!, 'emergencyContact') && (employee()!.emergencyContact || employee()!.emergencyPhone)" class="details-section">
            <h2 class="section-title">Emergency Contact</h2>
            <div class="details-grid">
              <div class="detail-item" *ngIf="employee()!.emergencyContact">
                <label class="detail-label">Contact Name</label>
                <span class="detail-value">{{ employee()!.emergencyContact }}</span>
              </div>
              <div class="detail-item" *ngIf="employee()!.emergencyPhone">
                <label class="detail-label">Contact Phone</label>
                <span class="detail-value">
                  <a [href]="'tel:' + employee()!.emergencyPhone" class="phone-link">
                    {{ employee()!.emergencyPhone }}
                  </a>
                </span>
              </div>
            </div>
          </div>

          <!-- Limited View Notice -->
          <div *ngIf="employee()!.isLimitedView" class="limited-view-notice">
            <div class="notice-icon">üîí</div>
            <p>You're viewing limited profile information. Contact your manager or HR for full access.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
