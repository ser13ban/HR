# Feature Plan 0005: Absence Request Management

## Brief Description
Implement a comprehensive absence request management system that allows users to request absence from their profile page, view their past requests in a table with status columns (pending, approved, declined), enables managers to access all coworkers' absence pages to approve/decline requests, and allows coworkers to view approved requests of other employees.

## Backend Changes

### Controllers
**Create:** `HrAPI/HrAPI/Controllers/AbsenceController.cs`
- `GET /api/absence/my-requests` - Get current user's absence requests
- `GET /api/absence/employee/{employeeId}` - Get absence requests for specific employee (manager access)
- `GET /api/absence/approved` - Get all approved absence requests (for coworker visibility)
- `POST /api/absence` - Create new absence request
- `PUT /api/absence/{id}/approve` - Approve absence request (manager only)
- `PUT /api/absence/{id}/decline` - Decline absence request (manager only)
- `DELETE /api/absence/{id}` - Cancel own absence request (if pending)

### Services
**Create:** `HrAPI/HrAPI/Services/IAbsenceService.cs`
- Interface defining absence service contract

**Create:** `HrAPI/HrAPI/Services/AbsenceService.cs`
- Business logic for absence request operations
- Permission validation (managers can approve/decline, users can only manage their own)
- Date validation and conflict checking

### DTOs
**Create:** `HrAPI/HrAPI/DTOs/AbsenceRequestDto.cs`
- Response DTO for absence requests with employee information

**Create:** `HrAPI/HrAPI/DTOs/CreateAbsenceRequestDto.cs`
- Request DTO for creating absence requests

**Create:** `HrAPI/HrAPI/DTOs/ApprovalActionDto.cs`
- Request DTO for approval/decline actions with notes

### Database Changes
- AbsenceRequest model already exists in `HrAPI/HrAPI/Models/AbsenceRequest.cs`
- Database configuration already exists in `HrAPI/HrAPI/Data/HrDbContext.cs`
- Employee relationship already configured

## Frontend Changes

### Models
**Create:** `hr-app/src/app/core/models/absence.models.ts`
- TypeScript interfaces for AbsenceRequest, CreateAbsenceRequest, ApprovalAction
- AbsenceType and AbsenceStatus enums matching backend

### Services
**Create:** `hr-app/src/app/core/services/absence.service.ts`
- HTTP client service for absence-related API calls
- Methods for all CRUD operations and approval actions

### Components

**Create:** `hr-app/src/app/features/absence/absence-page/absence-page.component.ts`
- Main absence management component
- Displays user's own requests in table format with status column
- Request form for new absence requests
- Manager view showing all employee requests with approve/decline actions
- Coworker view showing approved requests only

**Create:** `hr-app/src/app/features/absence/absence-page/absence-page.component.html`
- Template with three main sections:
  - Request form (collapsible)
  - My requests table (status: pending, approved, declined)
  - Manager section (if manager role): All requests with action buttons
  - Coworker section: Approved requests of all employees

**Create:** `hr-app/src/app/features/absence/absence-page/absence-page.component.sass`
- Styling for absence page following existing design patterns

### Profile Integration
**Modify:** `hr-app/src/app/features/profile/profile.component.html`
- Add "Absence Requests" button in the action buttons section (lines 46-63)
- Button should navigate to absence page for current user

**Modify:** `hr-app/src/app/features/profile/profile.component.ts`
- Add `onViewAbsenceRequests()` method to navigate to absence page

### Routing
**Modify:** `hr-app/src/app/app.routes.ts`
- Add route: `{ path: 'absence', canActivate: [AuthGuard], loadComponent: () => import('./features/absence/absence-page/absence-page.component').then(m => m.AbsencePageComponent) }`
- Add route: `{ path: 'absence/:employeeId', canActivate: [AuthGuard], loadComponent: () => import('./features/absence/absence-page/absence-page.component').then(m => m.AbsencePageComponent) }`

## Algorithms and Business Logic

### Permission System
1. **Own Requests**: Users can view/create/cancel their own pending requests
2. **Manager Access**: Managers can view all employees' requests and approve/decline them
3. **Coworker Visibility**: All users can view approved absence requests of coworkers

### Request Status Flow
1. Created → Pending (default)
2. Pending → Approved (by manager)
3. Pending → Rejected (by manager)  
4. Pending → Cancelled (by requestor)

### Date Validation
1. Start date cannot be in the past
2. End date must be after start date
3. Check for overlapping requests (business rule)

### Manager Dashboard Algorithm
1. If user is manager, show additional section with all pending requests
2. Group requests by status for better organization
3. Provide bulk approval actions if needed

### Coworker View Algorithm  
1. Filter absence requests by status = Approved
2. Display employee name, dates, and absence type
3. Exclude personal/sensitive information in reason field

## Implementation Notes
- Use Angular signals for reactive state management throughout components
- Follow existing patterns from feedback and employee services
- Implement proper error handling and loading states
- Use existing form validation patterns from profile component
- Maintain consistent styling with existing components
- Add proper TypeScript typing for all DTOs and models
- Implement authorization checks on both frontend and backend
