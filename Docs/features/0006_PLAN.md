# Feature Plan 0006: AI-Powered Feedback Improvement

## Brief Description
Add functionality to improve feedback using AI by integrating a free HuggingFace model. Users will be able to click an "Improve with AI" button that sends their feedback text to an LLM with the prompt "Help me re-write and improve this feedback for my colleague" and replaces the original text with the improved version.

## Technical Implementation

### Phase 1: Backend API Integration

#### New API Service
**File: `HrAPI/HrAPI/Services/IHuggingFaceService.cs`**
- Create interface with method: `Task<string> ImproveFeedbackAsync(string originalText)`

**File: `HrAPI/HrAPI/Services/HuggingFaceService.cs`**
- Implement HuggingFace API integration using HttpClient
- Use free model: `microsoft/DialoGPT-medium` or `facebook/blenderbot-400M-distill` for text improvement
- Construct prompt: "Help me re-write and improve this feedback for my colleague: [original_text]"
- Handle API errors and timeouts gracefully
- Add retry logic for failed requests
- Parse and return improved text from model response

#### Configuration
**File: `HrAPI/HrAPI/appsettings.json` and `HrAPI/HrAPI/appsettings.Development.json`**
- Add HuggingFace API configuration:
  ```json
  "HuggingFace": {
    "BaseUrl": "https://api-inference.huggingface.co",
    "Model": "microsoft/DialoGPT-medium",
    "ApiKey": "" // Optional for free models
  }
  ```

#### Dependency Injection
**File: `HrAPI/HrAPI/Program.cs`**
- Register `IHuggingFaceService` and `HuggingFaceService` in DI container
- Configure HttpClient for HuggingFace service

#### New Controller Endpoint
**File: `HrAPI/HrAPI/Controllers/FeedbackController.cs`**
- Add new endpoint: `[HttpPost("improve-text")]`
- Accept request body with original feedback text
- Call HuggingFace service to improve text
- Return improved text in response
- Add proper error handling and validation
- Ensure only authenticated users can access

#### DTOs
**File: `HrAPI/HrAPI/DTOs/ImproveFeedbackDto.cs`**
- Create new DTO for request: `ImproveFeedbackRequestDto` with `OriginalText` property
- Create new DTO for response: `ImproveFeedbackResponseDto` with `ImprovedText` property

### Phase 2: Frontend Integration

#### Service Method
**File: `hr-app/src/app/core/services/feedback.service.ts`**
- Add new method: `improveFeedbackText(originalText: string): Observable<string>`
- Make HTTP POST request to `/api/feedback/improve-text`
- Handle errors and return improved text

#### Component Updates
**File: `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.ts`**
- Add new signal: `isImprovingText = signal<boolean>(false)`
- Add method: `improveFeedbackWithAI(): void`
- Implement logic to:
  1. Get current content from form
  2. Validate content is not empty
  3. Set loading state
  4. Call feedback service to improve text
  5. Replace form content with improved text
  6. Handle errors and show user feedback
  7. Reset loading state

#### Template Updates
**File: `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.html`**
- Add "Improve with AI" button next to the feedback textarea
- Position button below character count, above textarea
- Show loading spinner when `isImprovingText()` is true
- Disable button when:
  - Form content is empty
  - Already improving text
  - Form is being submitted
- Add appropriate styling and accessibility attributes

#### Styling
**File: `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.sass`**
- Add styles for the "Improve with AI" button
- Ensure consistent styling with existing form elements
- Add hover and disabled states
- Style loading spinner for AI improvement

### Algorithm Details

#### HuggingFace API Integration Flow:
1. Receive original feedback text from frontend
2. Construct prompt: "Help me re-write and improve this feedback for my colleague: {originalText}"
3. Send POST request to HuggingFace Inference API
4. Parse response and extract improved text
5. Return improved text to frontend
6. Frontend replaces original text in textarea

#### Error Handling:
1. API timeout: Show user-friendly message "AI service is currently unavailable"
2. Empty response: Fall back to original text
3. API rate limiting: Show message about trying again later
4. Network errors: Graceful degradation with retry option

### Files to Create:
- `HrAPI/HrAPI/Services/IHuggingFaceService.cs`
- `HrAPI/HrAPI/Services/HuggingFaceService.cs`
- `HrAPI/HrAPI/DTOs/ImproveFeedbackDto.cs`

### Files to Modify:
- `HrAPI/HrAPI/Controllers/FeedbackController.cs`
- `HrAPI/HrAPI/Program.cs`
- `HrAPI/HrAPI/appsettings.json`
- `HrAPI/HrAPI/appsettings.Development.json`
- `hr-app/src/app/core/services/feedback.service.ts`
- `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.ts`
- `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.html`
- `hr-app/src/app/features/feedback/give-feedback/give-feedback.component.sass`

### Dependencies:
- No new NuGet packages required (using built-in HttpClient)
- HuggingFace Inference API (free tier)
- Model: `microsoft/DialoGPT-medium` or similar free text generation model
